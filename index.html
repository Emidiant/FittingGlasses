<html>
<head>
    <title>threejs - models</title>
    <link href="style.css" rel="stylesheet">
    <script type="text/javascript" src="https://unpkg.com/webcam-easy/dist/webcam-easy.min.js"></script>
</head>
<body>

    <video id="webcam" autoplay playsinline></video>
    <canvas id="canvas" class="d-none"></canvas>
    <audio id="snapSound" src="audio/snap.wav" preload = "auto"></audio>

    <script>
        const webcamElement = document.getElementById('webcam');
        const canvasElement = document.getElementById('canvas');
        const snapSoundElement = document.getElementById('snapSound');
        const webcam = new Webcam(webcamElement, 'user', canvasElement, snapSoundElement);

        webcam.start()
            .then(result =>{
                console.log("webcam started");
            })
            .catch(err => {
                console.log(err);
            });

        // var picture = webcam.snap();

        webcam.stop();
    </script>

    <canvas id="myCanvas"></canvas>

    <script src="three.js"></script>
    <script src="GLTFLoader.js"></script>

    <script>
        var renderer,
            scene,
            camera,
            myCanvas = document.getElementById('myCanvas');

        //RENDERER
        renderer = new THREE.WebGLRenderer({
          canvas: myCanvas,
          antialias: true,
          transparent: true
        });
        renderer.setClearColor(0x000000, 0);
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.setSize(640, 480);

        //CAMERA
        camera = new THREE.PerspectiveCamera(50, window.innerWidth/window.innerHeight, 0.01, 5000);
        // camera.rotation.y = 45/180*Math.Pi;
        // camera.position.x = 800;
        camera.position.y = 30;
        camera.position.z = 70;

        //SCENE
        scene = new THREE.Scene();
        video = document.getElementById( 'webcam' );


        var vidTexture = new THREE.VideoTexture(video);

        scene.background = vidTexture;


        //LIGHTS
        var light = new THREE.AmbientLight(0xffffff, 0.5);
        scene.add(light);

        var light2 = new THREE.PointLight(0xffffff, 0.5);
        scene.add(light2);

        var loader = new THREE.GLTFLoader();

        loader.load('models/vuzix.glb', handle_load);

        var mesh;

        function handle_load(gltf) {

            console.log(gltf);
            mesh = gltf.scene;
            console.log(mesh.children[0]);
            mesh.children[0].material = new THREE.MeshLambertMaterial();
            scene.add( mesh );
            mesh.position.z = -10;
        }


        //RENDER LOOP
        render();

        var delta = 0;
        var prevTime = Date.now();

        function render() {
            delta += 0.1;
            if (mesh) {
                mesh.rotation.y += 0.01;
            }
            renderer.render(scene, camera);
            requestAnimationFrame(render);
        }

    </script>


</body>
</html>
